package main

import (
	"log"
	"net"
	"time"
)

func newConn() net.Conn {
	conn, _ := net.Dial("tcp", ":8000")
	return conn
}

func main() {
	conn, err := net.Dial("tcp", ":8000")
	if nil != err {
		log.Println(err)
		conn = newConn()
	} else {
		log.Println("Connected to Server")
		go func() {
			data := make([]byte, 4096)

			// 무한 반복
			for {
				conn = newConn()
				n, err := conn.Read(data)
				if err != nil {
					// 서버 종료시 10초 대기
					log.Println(err)
					time.Sleep(time.Duration(1) * time.Second)
					log.Println(conn)

				} else {
					log.Println("Server send : " + string(data[:n]))
					time.Sleep(time.Duration(1) * time.Second)
				}

			}

		}()
		for {
			time.Sleep(1)
			if nil != err {
				log.Println(err)

			}

		}
	}

}
