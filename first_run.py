import os
import subprocess

from antigravity.uac_require import uac_require

SET_UP_DIR = os.path.expanduser('~') + '\\.Anti-Gravity'
SVC_PROG_PATH = os.path.expanduser('~') + '\\.Anti-Gravity\\Anti-Gravity-Agent.exe'
SVC_NAME = 'Anti-Gravity-Service'
# 1. 관리자 권한 실행
if uac_require():

    if os.path.isdir(SET_UP_DIR) is False:
        os.mkdir(SET_UP_DIR)

    # 2. 기존 서비스 조회 및 삭제
    try:
        output = subprocess.check_output(f'sc query {SVC_NAME}')
        os.system(f'sc delete {SVC_NAME}')
    except:
        print('error')

    # 3. Anti-Gravity-Agent 서비스 등록
    os.system(f'sc create {SVC_NAME} binPath={SVC_PROG_PATH} start=auto')
    os.system(f'{SVC_PROG_PATH}')
    # os.system(f'sc start {SVC_NAME}')
else:
    print('bad')
