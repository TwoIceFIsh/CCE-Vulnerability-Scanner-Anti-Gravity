import os
import shutil

from antigravity.uac_require import uac_require

SET_UP_DIR = os.path.expanduser('~') + '\\.Anti-Gravity'
SVC_PROG_PATH = os.path.expanduser('~') + '\\.Anti-Gravity\\Anti-Gravity-Agent.exe'
SVC_NAME = 'Anti-Gravity-Service'
SYS_PATH = os.environ['WINDIR']

# 1. 관리자 권한 실행
if uac_require():

    # 설치 폴더 생성
    if os.path.isdir(SET_UP_DIR) is False:
        os.mkdir(SET_UP_DIR)

    # 설치 폴더로 복사
    shutil.copytree('.\\install', SET_UP_DIR, dirs_exist_ok=True)

    # 작업 스케줄 등록
    os.system(
        f'SCHTASKS /Create /TN {SVC_NAME} /SC ONSTART /TR {SVC_PROG_PATH} /RU "SYSTEM" /RL HIGHEST /F')
    #

    # 서비스 실행
    # os.system(f'SCHTASKS /Run /TN {SVC_NAME}')
else:
    print('bad')
