import os

from antigravity.comments import *
from antigravity.tools import get_file, to_utf8, is_encoded
from options import *


def win_pc_init():
    print('##### win_pc_init')
    if os.path.isdir(f'{LOG_PATH}') is False:
        os.mkdir(f'{LOG_PATH}')

    os.system(f'secedit /EXPORT /CFG {LOG_PATH}\\{LOCAL_SECURITY_POLICY}')
    os.system(f'systeminfo > .\\{LOG_PATH}\\{SYSTEM_INFO}')
    # os.system(f'net share | find /V "IPC$" | find "$" > .\\{LOG_PATH}\\{NET_SHARE}')

    try:
        for i in os.listdir(f'.\\{LOG_PATH}'):
            to_utf8(file_path=f'./{LOG_PATH}/{i}',
                    encoding_in=is_encoded(file_path=f'./{LOG_PATH}/{i}'))

    except FileNotFoundError:
        print('관리자 권한으로 실행해 주세요')
        input('')
        quit()


def win_pc_start():
    print('##### win_pc_start')
    local_security_policy = get_file(f'./{LOG_PATH}/{LOCAL_SECURITY_POLICY}')
    system_info = get_file(f'./{LOG_PATH}/{SYSTEM_INFO}')
    # net_share = get_file(f'./{LOG_PATH}/{NET_SHARE}')

    sw_01(local_security_policy)
    sw_02(local_security_policy)
    # sw_03(net_share)


def sw_01(text_lines: str):
    print('##### sw_01')
    for line in text_lines:
        if 'MaximumPasswordAge = ' in line:
            data = int(line.strip().split(' = ')[1])
            if int(data) > 90:
                print(PC1_NK)
            else:
                print(PC1_OK)
            return


def sw_02(text_lines: str):
    data1 = 0
    data2 = 0
    for line in text_lines:
        if 'PasswordComplexity = ' in line:
            data1 = int(line.strip().split(' = ')[1])

        if 'MinimumPasswordLength = ' in line:
            data2 = int(line.strip().split(' = ')[1])

    if data1 == 1:
        if data2 >= 8:
            print(PC2_OK)
        else:
            print(PC2_NK)
    else:
        print(PC2_NK)


def sw_03(text_lines: str):
    for line in text_lines:
        print(line)
