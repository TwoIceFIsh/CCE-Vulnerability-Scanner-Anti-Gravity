import os
import smtplib
from email.encoders import encode_base64
from email.mime.base import MIMEBase
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.utils import formataddr


def send_mail(to_ad: str, file_path: list, body_text: list):
    from_addr = formataddr(('SOCH', 'bh.lee@email.com'))

    # 받는사람
    to_addr = formataddr(('보안담당자', to_ad))

    session = None
    try:
        # SMTP 세션 생성
        session = smtplib.SMTP('smtp.gmail.com', 587)
        # session.set_debuglevel(True)

        # SMTP 계정 인증 설정
        session.ehlo()
        session.starttls()
        session.login('igloosoil@gmail.com', 'lougwydyuijffjcd')

        # 메일 콘텐츠 설정
        message = MIMEMultipart("mixed")

        # 메일 송/수신 옵션 설정
        message.set_charset('utf-8')
        message['From'] = from_addr
        message['To'] = to_addr
        message['Subject'] = f"[수집완료] 데이터 {body_text[0]}({body_text[1]})"
        # 메일 콘텐츠 - 내용
        body = f"{body_text}"
        bodyPart = MIMEText(body, 'html', 'utf-8')
        message.attach(bodyPart)

        for f in file_path:
            part = MIMEBase('application', "octet-stream")
            part.set_payload(open(f, "rb").read())
            encode_base64(part)
            part.add_header('Content-Disposition', 'attachment; filename="%s"' % os.path.basename(f))
            message.attach(part)

        # 메일 발송
        session.sendmail(from_addr, to_addr, message.as_string())

    except Exception as e:
        print(e)
    finally:
        if session is not None:
            session.quit()
