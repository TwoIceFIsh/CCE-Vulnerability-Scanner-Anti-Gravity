import os

from antigravity.uac_require import uac_require

AGENT_FILE_NAME = 'Anti-Gravity-Agent.exe'
SET_UP_DIR = os.path.expanduser('~') + '\\.Anti-Gravity'
SVC_PROG_PATH = os.path.expanduser('~') + f'\\.Anti-Gravity\\{AGENT_FILE_NAME}'
SVC_START_PROGRAM = os.path.expanduser('~') + '\\.Anti-Gravity\\start.bat'
SVC_NAME = 'Anti-Gravity-Service'

if uac_require():

    if os.path.isdir(SET_UP_DIR) is False:
        os.mkdir(SET_UP_DIR)

    # 2. 기존 서비스 조회 및 삭제
    try:
        os.system(f'sc delete {SVC_NAME}2')
    except:
        print('error')

    # 3. Anti-Gravity-Agent 서비스 등록
    os.system(f'sc create {SVC_NAME} binPath={SVC_PROG_PATH} start= auto')
    os.system(f'sc failure reset= 60 {SVC_NAME} command= "{SVC_PROG_PATH}" actions= run/5000')
    # os.system(f'{SVC_PROG_PATH}')
    # output = subprocess.check_output(f'sc start {SVC_NAME}')
    # output = subprocess.check_output(f'sc start {SVC_NAME}')

    # if '1053' in str(output):
    #     # os.system('sfc /scannow')
    #     os.system('DISM /Online /Cleanup-image /RestoreHealth')
else:
    print('bad')
